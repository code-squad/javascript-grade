<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <script>

        // 학점 계산기(step3)

        // 과목 정보 객체 생성
        const gradeData = [
            {
                'name': '데이터베이스',
                'grade': 'B+',
                'credit': 3,
                'major': true
            },
            {
                'name': '교양영어',
                'grade': 'B',
                'credit': 1,
                'major': false
            },
            {
                'name': '철학',
                'grade': 'C+',
                'credit': 1,
                'major': false
            },
            {
                'name': '컴퓨터공학',
                'grade': 'A',
                'credit': 2,
                'major': true
            },
            {
                'name': '자료구조개론',
                'grade': 'A+',
                'credit': 2,
                'major': true
            },
            {
                'name': '빅데이터응용',
                'grade': 'B',
                'credit': 3,
                'major': true
            }
        ];

        // 학점 척도 (4.5기준)
        const standardScale = {
            "A+": 4.5,
            "A": 4,
            "B+": 3.5,
            "B": 3,
            "C+": 2.5,
            "C": 2,
            "D+": 1.5,
            "D": 1
        }

        // 객체 생성(네임 스페이스 설정)
        const gradeInfo = {


            // main 메소드 
            showGradeInfo(gradeData, otherScale) {
                this.sumGradeData(gradeData, otherScale);
            },


            // 과목 추가 메소드
            addLecture(lectureData, otherScale) {
                const lectureObj = this.duplicateObj(lectureData);
                gradeData.push(lectureObj);
                console.log(`과목 추가----------------`)
                this.showGradeInfo(gradeData, otherScale);
            },


            // 객체 복제 메소드
            duplicateObj(lectureData) {
                const lectureObj = {};
                for (let key in lectureData) {
                    lectureObj[key] = lectureData[key];
                }
                return lectureObj;
            },


            // 과목 삭제 메소드
            removeLecture(lectureName, time, otherScale) {
                setTimeout(() => {
                    gradeData.forEach((val, idx) => {
                        if (val.name === lectureName) {
                            gradeData.splice(idx, 1);
                        }
                    });
                    console.log(`과목 삭제-------------------`)
                    this.showGradeInfo(gradeData, otherScale);
                }, time);
            },


            // 데이터 정렬 메소드
            sortMyGrade(gradeData) {
                const arrByCredit = gradeInfo.sortByGrade(gradeData);
                console.log(`데이터 정렬-------------------`);
                arrByCredit.forEach(val =>
                    console.log(`'${val.name}', '${val.grade}', '${val.credit}'`)
                )
                console.log(`---------------------------`);
            },


            // 성적순 데이터 정렬 메소드
            sortByGrade(gradeData) {
                const pointScale = ["A+", "A", "B+", "B", "C+", "C", "D+", "D"];
                this.arrByCredit = [];
                pointScale.forEach(grade => {
                    let arrByGrade = [];
                    gradeData.filter(val => {
                        if (val.grade === grade) {
                            arrByGrade = arrByGrade.concat(val);
                        }
                    });
                    gradeInfo.sortByCredit(arrByGrade);
                });
                return this.arrByCredit;
            },


            // 이수 학점순 데이터 정렬 메소드
            sortByCredit(arrByGrade) {
                arrByGrade.sort((a, b) =>
                    b.credit - a.credit
                );
                this.arrByCredit = this.arrByCredit.concat(arrByGrade);
            },


            // 총 학점 합계, 전공 학점 합계, 전공 과목수, 총이수학점, 전공이수학점 구하기 메소드
            sumGradeData(gradeData, otherScale) {
                let sumPoint = 0, // 총 학점 합계
                    sumPointMajor = 0, // 전공 학점 합계
                    countMajor = 0, // 전공 과목수
                    sumCredit = 0, // 총 이수학점
                    sumCreditMajor = 0; // 전공 이수학점

                gradeData.forEach(val => {
                    sumPoint += standardScale[val.grade];
                    sumCredit += val.credit;
                    if (val.major) {  // 전공과목인 경우 별도의 변수에 할당
                        sumPointMajor += standardScale[val.grade];
                        countMajor += 1;
                        sumCreditMajor += val.credit;
                    }
                });
                console.log(
                    this.calGpaTotal(gradeData, otherScale, sumPoint) + ", " +
                    this.calGpaMajor(gradeData, otherScale, sumPointMajor, countMajor) + ", " +
                    "이수학점: " + sumCredit + ", " + "전공 이수학점: " + sumCreditMajor
                );
                console.log(`총과목 수: ${gradeData.length}\n전공과목 수: ${countMajor}`);
            },


            // 총평점 계산 메소드
            calGpaTotal(gradeData, otherScale, sumPoint) {
                let gpaStandard = 0, // 4.5기준 평점
                    gpaOtherScale = 0; // 기타 기준 평점
                gpaStandard = (sumPoint / gradeData.length).toFixed(2);
                gpaOtherScale = ((gpaStandard / 4.5) * otherScale).toFixed(2);
                return `4.5기준 총평점: ${gpaStandard}(${otherScale}기준 ${gpaOtherScale})`;
            },


            // 전공평점 계산 메소드
            calGpaMajor(gradeData, otherScale, sumPointMajor, countMajor) {
                let gpaStandard = 0,  // 4.5기준 평점
                    gpaOtherScale = 0; // 기타 기준 평점
                gpaStandard = (sumPointMajor / countMajor).toFixed(2);
                gpaOtherScale = ((gpaStandard / 4.5) * otherScale).toFixed(2);
                return `전공평점: ${gpaStandard}(${otherScale}기준 ${gpaOtherScale})`;
            }
        };


        //main 메소드 호출
        gradeInfo.showGradeInfo(gradeData, 4.3);

        // 과목 추가 메소드 호출
        gradeInfo.addLecture({ 'name': '알고리즘', 'grade': 'A', 'credit': 3, 'major': true }, 3.5);
        gradeInfo.addLecture({ 'name': '서양사의 이해', 'grade': 'C+', 'credit': 2, 'major': false }, 3.5);

        // 데이터 정렬 메소드 호출
        gradeInfo.sortMyGrade(gradeData);

        // 과목 삭제 메소드 호출
        //gradeInfo.removeLecture("컴퓨터공학", 2000, 3.8);


    </script>

</body>

</html>